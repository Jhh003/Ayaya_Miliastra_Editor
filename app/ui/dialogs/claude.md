## 目录用途
- 存放基于 PyQt6 的弹出对话框、小型编辑面板与复合编辑控件。
- 这些组件通常作为管理页面或右侧属性面板的子组件出现，例如结构体定义编辑对话框、信号编辑对话框等。

## 当前状态
- 大多数业务对话框统一继承 `app.ui.foundation.base_widgets.BaseDialog` 或 `app.ui.dialogs.management_dialog_base.ManagementDialogBase`，由基类负责窗口标题、基础布局（内容区 + 标准按钮区）与主题样式，具体对话框只关注内容区域的表单/表格与结果导出；设置类对话框如 `SettingsDialog` 会结合 `app.ui.graph.library_mixins.ConfirmDialogMixin` 使用统一的 `confirm / show_info / show_warning` 弹窗接口，保持与库页面一致的提示与确认风格。`SettingsDialog` 中已绑定 GRAPH_UI_VERBOSE（图编辑器详细日志）到“输出与打印”分组，用于控制自动排版等调试打印是否输出。
- 结构体定义相关组件：
  - `struct_definition_dialog_impl.py`：结构体定义编辑核心组件与对话框外壳，字段表格采用“字段主行 + 详情行”的两行结构，普通/结构体等基础类型在主行直接编辑值，列表/字典等集合类型则在主行的“数据值”列展示“折叠按钮 + 摘要”，并在紧随其后的详情行中以内联子表格形式展开实际内容：详情行保留左侧的序号列作为灰色禁用缩进区域，其余三列合并为一整块子表格区域，让列表/字典子表格的可用宽度几乎与父表格一致，仅比父表格少一列缩进；列表与字典的内联编辑器在创建时默认处于折叠状态，仅展示“X 个元素 / X 条目”等摘要信息并隐藏子表格，当用户点击折叠按钮后再展开完整内容，以降低大字段或嵌套集合较多时切换到结构体编辑视图的初始渲染压力；字段删除统一通过字段行右键菜单完成，整行任意位置右键均触发同一“删除字段”菜单项，不在额外工具栏或单元格内提供独立删除按钮，降低误删风险并保持交互一致；在管理面板右侧嵌入使用时支持切换为只读模式，仅作结构体代码级定义的浏览视图，实际增删改通过对应 Python 资源进行。
  - `struct_definition_value_editors.py`：结构体字段集合类值编辑组件与通用输入控件的聚合入口，统一导出列表/字典值编辑器（内联子表格 + 弹窗）以及 `ClickToEditLineEdit` / `ScrollSafeComboBox` 等基础控件；具体实现按职责拆分在 `list_value_editors.py`（列表值编辑器）、`dict_value_editors.py`（字典值编辑器）和 `value_editor_common_widgets.py`（通用行内编辑控件）中：列表字段与对应弹窗复用“序号 + 值”的基础列表表格组件，统一列宽策略、行高和“元素值”占位文案，表格末尾始终保留一行空白占位行用于新增元素，删除通过行级右键菜单触发“删除当前行”；字典字段与对应弹窗复用“序号 + 键 + 值”的基础字典表格组件，键/值输入单元格统一使用 `ClickToEditLineEdit` 包裹收窄可编辑命中区域，键/值类型选择区通过 `ScrollSafeComboBox` 实现“未聚焦时忽略滚轮”的防误触行为，并在子表格上方使用二维网格布局将“键类型 / 值类型”分别放置在“键 / 值”两列的正上方，视觉上与列对齐；字典子表格同样在末尾保留空白占位行，行级右键菜单通过 `ContextMenuBuilder` 提供“删除当前行”操作，样式与管理/库页面的右键菜单保持一致。

## 注意事项
- 对话框应保持轻量职责：组装 UI、绑定信号、导出结果；复杂业务逻辑优先放在上层页面或核心模型中处理。
- 列表/字典等集合型编辑器会嵌入到父级表格的“数据值”单元格中，行高由外层结构体编辑器根据内部子表格的行数与折叠状态统一调整；同时，`_ListTableEditorWidget` 与 `_DictTableEditorWidget` 在元素/条目数量变化时会先根据单元格内容自动调整每行高度，再结合 `QTableWidget.verticalHeader().length()` 动态撑高自身内部表格的最小/最大高度，使得在展开状态下尽量完整展示所有子行而不依赖子表格自身的垂直滚动条，折叠时仅保留头部“折叠按钮 + 摘要”行保持紧凑；子表格内部的“值/键/值”单元格同样使用 `ClickToEditLineEdit` 并通过轻量容器包裹，仅在显式点击输入框本身时才获得焦点，点击子表格行背景仅改变选中行。
- 结构体定义相关的字段编辑控件整体遵循“显式点击后再编辑”的约束：数据类型/键类型/值类型等下拉框在未获得焦点时不响应滚轮事件，字段名与所有层级“数据值”文本框都通过 `ClickToEditLineEdit`+容器手法收窄可编辑命中区域，避免仅靠表格选中或滚轮滚动就意外修改内容；信号编辑对话框中的参数表格同样采用“工具栏 + 表格”内联模板构建，顶部提供“+ 添加参数 / - 删除参数”按钮，右键菜单提供“删除参数”行级操作，单元格内的名称、类型与描述编辑控件统一通过轻量容器包装并将右键事件转发到表格级菜单，使信号管理面板与对话框在参数增删与右键语义上保持一致，描述文本区域根据内容自适应高度（在对话框与嵌入式视图中均限制最大高度），参数表格在需要完整展示时可以按行数自动撑高并通过外层滚动区域承载整体页面滚动。
- 避免在此目录中使用 `try/except` 兜底异常，错误由调用方统一处理或直接抛出。

## 目录用途
`ui/dialogs/` 目录集中存放应用内使用的各类模态或非模态对话框组件，例如设置对话框、图详情对话框、信号管理对话框等。

- 主要职责：
  - 承载以窗口或弹窗形式呈现的交互界面
  - 提供配置编辑、信息查看与用户确认等操作入口
  - 与主窗口及控制器协作完成具体业务逻辑

## 当前状态
- 设置相关：包含程序设置、管理配置等对话框组件。程序设置页按“自动排版 / 输出与打印 / 步骤与任务 / 执行与系统 / 资源库更新”分区，自动排版部分提供如“块与块之间紧密排列”“数据节点跨块复制”“布局Y调试叠加”等即时开关；“步骤与任务”分组包含任务清单的连线合并开关与节点图步骤生成顺序（默认 AI：先创建再连接）；“执行与系统”部分包含界面主题（跟随系统/浅色/深色）、自动保存间隔、鼠标执行模式与拖拽策略等选项；“资源库更新”分组通过下拉框绑定 `settings.RESOURCE_LIBRARY_AUTO_REFRESH_ENABLED`，允许在“自动更新（检测到资源库变更时自动刷新索引与视图）”与“手动更新（仅在点击主窗口顶部‘更新’按钮时刷新资源库）”之间切换；缓存管理通过底部按钮区域的“清除所有缓存”入口提供，与“重置为默认值”并列展示。
- 设置页的“清除所有缓存”会删除 `app/runtime/cache/graph_cache` 下的节点图持久化缓存文件，并同步清空 `GraphDataService` 桥接的进程内 graph_data payload 缓存与其 GraphModel/索引缓存；随后在清理资源后调用主窗口控制器强制关闭正在编辑的节点图并导航回图库列表，保证缓存与文件监控彻底释放且各入口不会再回退到旧数据。
- 图相关：包含节点图详情查看、节点图选择与变量编辑等对话框组件；`GraphVariableDialog` 嵌入 `GraphVariableTableWidget`，仅负责壳层与信号转发；`GraphSelectionDialog` 复用 `GraphLibraryWidget` 的 selection mode，通过信号获取选中 ID，并允许调用方按需限定可选节点图范围（例如仅允许选择客户端节点图下“技能节点图”文件夹中的图），在限定上下文中如选中不满足类型或文件夹前缀约束的图会给出明确的警告提示；节点图详情对话框通过共享的 `GraphReferencesTableWidget` 在“被哪些对象使用”列表中以“元件 / 实体 / 关卡实体”三类标签展示引用来源，其中“实体”对应关卡中基于元件创建的摆放对象，与实体摆放页面的命名保持一致。
- 变量编辑：`variable_edit_dialogs.py` 提供通用表单骨架，`EntityVariableEditDialog` 与 `GraphVariableEditDialog` 继承同一个 `BaseDialog` 派生基类，共享输入字段与样式，两者的类型下拉均通过 `engine.graph.models.entity_templates.get_all_variable_types()` 获取“规范中文变量类型”列表，覆盖字符串/整数/浮点数/布尔值/三维向量/实体/GUID/配置ID/元件ID/阵营及其列表形式，以及 `字典`、`结构体` 与 `结构体列表`，与节点图变量和实体/模板自定义变量的类型体系保持一致；字典类型变量的键和值的数据类型通过嵌入的 `DictValueEditor` 在变量表格中单独选择和保存，保证 UI 与底层元数据中的“字典键/值类型”信息同步；`struct_list_item_dialog.StructListItemEditDialog` 为自定义变量中的“结构体列表”条目提供轻量编辑弹窗：在已选定基础结构体 ID 的前提下，根据结构体定义构造通用“两行结构字段表格”，字段名与数据类型列只读（表头使用“字段名 / 数据类型 / 字段值”等语义化标题），数据值列复用列表/字典/结构体等值编辑组件，顶部标题展示结构体名称及其 ID，标题下方附带简短说明文案，引导用户仅在“字段值”列中修改内容；对话框最终将结果以 `{字段名: 值}` 形式回写给调用方，用于实体摆放页面右侧属性面板中逐条维护关卡配置等结构体列表型变量。
- 系统管理：包含信号管理、冲突解决与管理面板相关的对话框；`SignalManagerDialog` 通过 `SignalTableWidget` 复用增删查逻辑，窗口顶部仅保留标题与动作区域，不额外展示全局信号说明文案，以保持管理界面简洁；`ConflictResolutionDialog` 用于节点图文件外部修改与本地未保存修改冲突时的二选一决策，支持在可用时同时展示“本地修改时间/外部修改时间”，并保证在缺失任一时间信息时也能稳定渲染。
- 统一骨架：`management_dialog_base.py` 继承 `BaseDialog`，对“标题 + 说明 + 内容区 + 关闭按钮”结构进行封装，`SignalManagerDialog`、`GraphVariableDialog` 等管理类弹窗共享该骨架并复用主题样式与文案排版。
- 管理面板相关的设置/信号/结构体等对话框统一通过 `FormDialog` + 表单字段定义或者 `app.ui.forms.schema_dialog.FormDialogBuilder` 组装表单，避免在本目录再维护重复的“新建 XX” 对话框实现。
- 专用编辑弹窗与编辑组件集中在独立模块：
  - `signal_edit_dialog.py`：提供可复用的 `SignalEditorWidget`（信号名 + 描述 + 参数表格）与 `SignalEditDialog` 对话框外壳，参数列表使用基于主题的表格与行内类型下拉组合展示“参数名 / 数据类型 / 描述”三列信息，类型选项统一复用 `engine.configs.specialized.node_graph_configs.StructDefinition.supported_types` 中信号所支持的基础与列表类型，保证与节点端口类型字符串保持一致；`SignalEditorWidget` 既可在信号编辑对话框中提供完整的增删改能力，也可嵌入管理面板右侧详情区并切换到只读模式，用于浏览代码级信号定义与参数结构：描述编辑框会根据文本内容自动调整高度（在一定上限内），参数表格在只读预览场景下通过计算行高和表头高度自动撑高自身，使表格内部不再出现垂直滚动条，由外层 `QScrollArea` 负责整体滚动。
  - `graph_variable_edit_dialog.py`：节点图变量表单
  - `struct_definition_dialog.py`：结构体定义编辑的入口模块，导出基于表格的结构体编辑能力（对话框与可嵌入组件）及常用类型工具/值编辑器；实现由 `struct_definition_dialog_impl.py`（封装为 `StructDefinitionDialog` 与可复用的 `StructDefinitionEditorWidget`）、`struct_definition_types.py`（中文类型名与 `param_type` 映射工具）和 `struct_definition_value_editors.py`（列表/字典/结构体等值编辑组件）组成，可同时服务于管理面板内嵌编辑区与独立对话框，统一使用"序号 / 名字 / 数据类型 / 数据值"表格结构并落盘为与 `test.json` 示例一致的 Struct JSON 结构（含 `param_type` 与嵌套 `value` 节点）。
  - `struct_viewer_dialog.py`：只读结构体查看对话框，复用 `StructDefinitionEditorWidget` 的只读模式，为"玩家模板自定义变量"等不可编辑场景下的结构体字段提供"查看"入口，展示结构体定义的详细字段列表，对话框仅包含"关闭"按钮。
- 结构体定义相关值编辑组件在表格中统一使用可见边界的输入框与下拉框，仅在显式点击单元格内部控件时开始编辑，避免光标仅划过或误点行背景就进入编辑态；列表字段的“数据值”单元格以内联子表格形式展示和编辑元素集合（无单独名称列，由父级字段的数据类型决定元素类型，子表格尾部始终保留空白占位行用于新增元素，通过右键菜单删除当前行，且可通过统一的 Chevron 折叠按钮收起为紧凑摘要视图），字典字段同样以内联子表格形式展示“序号 / 键 / 值”三列（上方为键/值类型下拉区，子表格尾部同样保留空白占位行并通过右键菜单删除条目，条目数量与内容变化会驱动行高与摘要更新，并通过浅色计数标签展示“空列表 / N 个元素 / N 条目”等信息），减少层级跳转，让结构体结构一目了然且视觉风格与管理面板其他统计标签保持一致。

## 注意事项
- 对话框应尽量保持“展示与收集输入”的职责，将业务处理委托给控制器或服务层。
- 样式与确认弹窗逻辑优先复用 `ThemeManager`（`dialog_surface_style()` 等）与 `app.ui.graph.library_mixins.ConfirmDialogMixin`，避免在各对话框内重复实现按钮与提示语；简单的警告/提示类弹窗统一通过 `app.ui.foundation.dialog_utils` 暴露的函数创建，不在本目录直接实例化 `QMessageBox`。
- 字体：对话框标题/说明等需要显式设置字体时统一使用 `app.ui.foundation.fonts`，避免硬编码平台字体族名导致跨平台缺字告警。
- 创建对话框时应避免在构造函数中执行耗时操作，必要时通过惰性加载或异步方式准备数据。
- 设置与其他对话框中的下拉框/数值框均遵循全局滚轮防误触规则：下拉列表未展开时滚轮不会改变选项，数值框仅在获得焦点时响应滚轮，避免用户在滚动窗口时误改配置。
- 结构体定义相关对话框在基础类型字段为空时，通过“无初始值”类占位提示引导用户补全数据；列表字段在空集合时以空子表格与“元素值”占位提示引导用户添加元素，字典字段在空集合时以空子表格与“键/值”占位提示引导用户补充键值对，保持与管理面板其他配置页一致的体验。
 - 表格类对话框（如信号参数编辑、结构体字段子表格）在选中行高亮上统一复用主题表格样式的基础设置（浅蓝选中背景 + 主文本色），保持与管理面板/列表页一致的“选中高亮”视觉反馈。
- 新增对话框时应优先继承 `app.ui.foundation.base_widgets.BaseDialog` / `FormDialog` 或 `app.ui.dialogs.management_dialog_base.ManagementDialogBase` 等封装基类，而不是在业务模块中直接从 `QtWidgets.QDialog` 派生；`tools/check_no_direct_qdialog.py` 用于静态检查基础封装层之外的新代码中是否直接使用 `QDialog`。
- 对话框内部的文本、背景与按钮配色应优先通过 `ThemeManager.Colors` 与统一样式工厂获取，避免直接写死十六进制颜色或 `QColor("#xxxxxx")`，以保证浅色/深色主题切换时视觉表现一致。

