## 目录用途
- 存放“代码结构规范”（M2）相关的规则实现，每个文件聚焦一个主题（if 条件、可变参数最小入参、图变量声明、信号参数名、类型名、常量赋值、事件名、局部变量初始值等）。
- 对外稳定入口仍为 `engine.validate.rules.code_structure_rules`，该文件仅负责 re-export，避免外部 import 路径随内部拆分改变。

## 当前状态
- 已按规则域拆分为多个小模块，降低单文件体积与耦合，便于缓存与性能优化点按域落地。
- 规则实现仅依赖引擎层模块（`engine.*`），不依赖 `app/*` / `plugins/*` / `tools/*`。
- 已包含“未知节点函数名”校验：当代码出现 `某函数(self.game, ...)` 形态但该函数名不在节点库中，会直接报错，避免拼写错误或不存在的节点名被静默跳过。
- 已包含“内置事件回调命名”校验：当 `register_event_handler` 注册的是内置事件时，回调必须为 `on_<事件名>`（严格一致）；信号事件（signal_id/信号名称）不强制回调名。
- 事件名/回调名相关规则支持“模块顶层字符串常量”（含注解赋值）作为事件名来源：例如 `事件名常量 = "定时器触发时"` 后传入 `register_event_handler(事件名常量, ...)` 仍会被校验；避免通过变量间接传入导致规则被跳过。
- 已包含 `on_XXX` 方法名严格校验：只要方法名以 `on_` 开头，`XXX` 必须是内置事件名或已定义信号名/ID；即使没有注册也会报错，防止“写了假的事件入口”长期潜伏。
- 类型名校验（`type_name.py`）与图变量/结构体相关规则统一以 `engine/type_registry.py` 作为规范中文类型名与别名字典解析的唯一事实来源，并在工作区维度合并节点库端口类型作为补充允许集合，避免多处硬编码类型清单漂移。
- 已包含“节点调用必填入参”校验：基于节点库静态输入端口清单，禁止 Graph Code 漏传必填端口参数（流程端口与变参占位端口除外），避免静默错误。
- 必填入参与布尔/事件名等规则会按节点图文件推断 scope（server/client），并使用该 scope 下的节点端口定义进行校验，避免同名节点在不同作用域端口不兼容时发生误报。
- 必填入参/可变参数最小入参规则在统计位置参数时会过滤 `self.game/game/owner_entity` 等保留参数（与 IR 的 `arg_normalizer` 口径一致），兼容节点函数“是否需要显式传 game”的差异。
- 已包含结构体“结构体名”值校验：要求可静态解析且必须存在于结构体定义列表中，避免拼写错误绕过校验。

## 注意事项
- 新增规则时请放入独立模块，并在 `__init__.py` 与 `engine.validate.rules.code_structure_rules` 的 re-export 列表中补齐。
- 避免跨模块互相 import 形成环；共享逻辑优先抽到同目录的独立 helper 模块（如后续确实需要）。


