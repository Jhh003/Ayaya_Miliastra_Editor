## 目录用途
存放引擎规则系统相关的配置与常量定义，包括实体类型规则、组件兼容性规则、节点挂载限制、数据类型规则等。这里的模块以“数据 + 轻量工具函数”为主，为校验器和运行时代码提供只读规则源。

## 当前状态
- 规则主要以字典、枚举和小型工具函数形式存在，聚焦规则表达本身。
- 被 `engine.validate.*` 与运行时逻辑引用，但不依赖 UI、CLI 或工具脚本。

## 注意事项
- 规则说明中可以引用概念名称和字段名，但不要硬编码外部知识库或文档系统的具体路径、URL 或文件层级。
- 如需标注规则来源，请使用抽象描述（如“内部设计规范”“内部规则文档”），避免暴露知识库目录结构。

# Rules 模块

## 目录用途
集中管理业务规则：实体能力与限制、组件兼容性、数据类型与挂载规则等，为验证与业务流程提供统一约束。

## 关键文件
- `entity_rules.py`：实体规则与能力限制（唯一事实来源，其它目录仅作兼容转发）
- `__init__.py`：集中导出 `ENTITY_TYPES`、`validate_entity_transform` 等公共规则入口
- `component_rules.py`：组件使用与兼容性规则
- `datatype_rules.py`：数据类型规则兼容转发层（权威定义集中在 `engine/type_registry.py`，避免多处清单漂移）
- `node_mount_rules.py`：节点图挂载规则与限制
- `datatypes_typing.py`：占位类型定义（中文类型名），供类型检查器识别；部分类型继承内置基础类型以减少静态类型检查噪音（例如整数/浮点数/字符串/列表等），运行时无行为，并包含结构体/自定义结构体/字典及其列表等别名类型，保证节点图侧使用的类型名在静态检查时都能被解析。节点图校验入口以 `engine.validate.node_graph_validator` 为准（runtime 侧仅 re-export）

## 面向开发者的要点
- **纯函数**：规则实现应无副作用、可测试、可复用
- **被动使用**：供 `validators` 与上层逻辑调用，不主动依赖 UI
- **文档化**：复杂规则需在代码注释中阐明前置条件与边界

## 注意事项与边界条件
- 修改规则需评估对验证器和生成器的连锁影响
- 通用组件元数据（名称、说明、适用实体）集中维护在 `engine.configs.components.component_registry` 中，`component_rules.py` 基于该注册表和实体规则提供组件兼容性校验与工具函数，不再在 `engine.validate.rules` 中重复维护一份组件规则定义。

## 当前状态
稳定运行中。实体与组件定义均以 `rules/*` 与 `components/component_registry.py` 为唯一事实来源，并与 `entity_templates.py` 中的 UI 展示保持一致；`entity_rules.validate_entity_transform()` 统一裁剪旋转/缩放/位置信息的可用性，供验证器直接复用，避免在不同入口重复判断实体的空间约束。

### 实体类型规范化约定
- 实体类型规范化逻辑集中由 `entity_rules.normalize_entity_type()` 提供，`component_rules.py` 等模块不再各自实现规范化。
- 包含 `"物件" -> "物件-动态"` 等别名映射在内的所有规范化规则都在同一处维护，确保规则一致、便于后续调整。

---

注意：本文件不记录任何修改历史。请始终保持对"目录用途、当前状态、注意事项"的实时描述。
